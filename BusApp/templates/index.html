<!DOCTYPE html>
<html lang="ja" data-bs-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page_title }}</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath fill='green' d='M4 1a2 2 0 0 0-2 2v10a1 1 0 0 0 1 1v1a1 1 0 0 0 2 0v-1h4v1a1 1 0 0 0 2 0v-1a1 1 0 0 0 1-1V3a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v2H3V3a1 1 0 0 1 1-1zm-1 4h10v6a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V6zm2 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm6 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z'/%3E%3C/svg%3E">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body>
  <div class="container">
    <h1 class="mt-4 mb-3 text-light">
      {{ page_title }}
    </h1>
    <h3 class="text-light mb-4">
      <i class="bi bi-calendar3"></i> {{ today }}
    </h3>
    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}
    <form method="post" action="search" class="d-flex align-items-center gap-2 my-3">
      <div class="form-floating">
        <select class="form-select" name="departure" id="departure">
          {% for i in range(stops|length) %}
            <option value="{{ i }}" {% if selected_departure == i %}selected{% endif %}>
              {{ stops[i] }}
            </option>
          {% endfor %}
        </select>
        <label for="departure">出発地</label>
      </div>
      <span>から</span>
      <div class="form-floating">
        <select class="form-select" name="arrival" id="arrival">
          {% for i in range(stops|length) %}
            <option value="{{ i }}" {% if selected_arrival == i %}selected{% endif %}>
              {{ stops[i] }}
            </option>
          {% endfor %}
        </select>
        <label for="arrival">到着地</label>
      </div>
      <button type="button" class="btn btn-secondary" onclick="swapStations()">⇄</button>
      <button type="submit" class="btn btn-primary">検索</button>
    </form>
  </div>

  {% if departure_stop and arrival_stop %}
  <div class="container">
    <div>
      <h3 class="mt-4 mb-3 pb-2 border-bottom border-light text-light">
        <i class="bi bi-bus-front"></i> 接近情報
      </h3>
      {% if approach_data %}
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th scope="col">接近情報</th>
              <th scope="col">系統・行先</th>
              <th scope="col">のりば</th>
              <th scope="col">のりばマップ</th>
            </tr>
          </thead>
          <tbody>
            {% for approach, bound_for, pole, map_url in approach_data %}
            <tr>
              <td>{{ approach }}</td>
              <td>{{ bound_for }}</td>
              <td>{{ pole }}</td>
              <td>
                {% if map_url %}
                  <a href="{{ map_url }}" target="_blank" class="btn btn-sm btn-outline-primary">マップ</a>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p>接近情報がありません</p>
      {% endif %}
    </div>
  </div>

  <div class="container">
    <div>
      <h3 class="mt-4 mb-3 pb-2 border-bottom border-light text-light">
        <i class="bi bi-clock"></i> 時刻表
      </h3>
      {% if schedule_data %}
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th scope="col">出発時刻</th>
              <th scope="col">到着時刻</th>
              <th scope="col">移動時間</th>
              <th scope="col">系統・行先</th>
              <th scope="col">のりば</th>
              <th scope="col">経路</th>
            </tr>
          </thead>
          <tbody>
            {% for dep_time, arr_time, duration, way, pole, url in schedule_data %}
            <tr>
              <td>{{ dep_time }}</td>
              <td>{{ arr_time }}</td>
              <td>{{ duration }}</td>
              <td>{{ way }}</td>
              <td>{{ pole }}</td>
              <td><a href="{{ url }}" target="_blank" class="btn btn-sm btn-outline-primary">通過時刻表</a></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p>時刻表データがありません</p>
      {% endif %}
    </div>
  </div>
  {% endif %}

  <script>
    function swapStations() {
      const departure = document.getElementById('departure');
      const arrival = document.getElementById('arrival');
      const tempValue = departure.value;
      departure.value = arrival.value;
      arrival.value = tempValue;
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
</body>
</html>
